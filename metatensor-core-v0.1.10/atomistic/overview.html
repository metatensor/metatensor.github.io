<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="API reference" href="reference/index.html" /><link rel="prev" title="Atomistic applications" href="index.html" />

    <link rel="shortcut icon" href="../_static/metatensor-64.png"/><!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Overview - Metatensor</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/css/metatensor.css?v=4d63172e" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Metatensor</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/images/metatensor-horizontal.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/images/metatensor-horizontal-dark.png" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../goals.html">Metatensor’s goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../core/index.html">Core classes</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Core classes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../core/overview.html">Overview</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/reference/python/index.html">Python API reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Python API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/python/tensor.html">TensorMap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/python/block.html">TensorBlock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/python/labels.html">Labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/python/io.html">Serialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/python/data.html">Data arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/python/misc.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/reference/cxx/index.html">C++ API reference</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of C++ API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/cxx/tensor.html">TensorMap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/cxx/labels.html">Labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/cxx/block.html">TensorBlock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/cxx/data.html">Data arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/cxx/misc.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/reference/c/index.html">C API reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of C API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/c/tensor.html">TensorMap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/c/labels.html">Labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/c/block.html">TensorBlock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/c/data.html">Data arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reference/c/misc.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../core/reference/rust/index.html">Rust API reference</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../examples/core/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/core/1-first-steps.html">First steps with metatensor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/core/2-handling-sparsity.html">Handling sparsity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/core/3-managing-gradients.html">Managing gradients</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../core/CHANGELOG.html">Changelog</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../operations/index.html">Operations</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Operations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../operations/torch.html">Operations and PyTorch</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../operations/reference/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../operations/reference/creation/index.html">Creation operations</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Creation operations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/creation/empty_like.html">empty_like()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/creation/ones_like.html">ones_like()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/creation/zeros_like.html">zeros_like()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/creation/random_like.html">random_like()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/creation/block_from_array.html">block_from_array()</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../operations/reference/linear_algebra/index.html">Linear algebra</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Linear algebra</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/linear_algebra/dot.html">dot()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/linear_algebra/lstsq.html">lstsq()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/linear_algebra/solve.html">solve()</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../operations/reference/logic/index.html">Logic function</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Logic function</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/logic/allclose.html">allclose()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/logic/equal.html">equal()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/logic/equal-metadata.html">equal_metadata()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/logic/is-contiguous.html">is_contiguous()</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../operations/reference/manipulation/index.html">Manipulation operations</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Manipulation operations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/manipulation/detach.html">detach()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/manipulation/drop-blocks.html">drop_blocks()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/manipulation/join.html">join()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/manipulation/make-contiguous.html">make_contiguous()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/manipulation/manipulate-dimension.html">manipulate dimension</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/manipulation/one-hot.html">one_hot()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/manipulation/remove-gradients.html">remove_gradients()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/manipulation/requires-grad.html">requires_grad()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/manipulation/samples-reduction.html">samples reduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/manipulation/slice.html">slice()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/manipulation/split.html">split()</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../operations/reference/math/index.html">Mathematical functions</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Mathematical functions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/math/abs.html">abs()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/math/add.html">add()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/math/divide.html">divide()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/math/multiply.html">multiply()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/math/pow.html">pow()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/math/subtract.html">subtract()</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../operations/reference/set/index.html">Set operations</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of Set operations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/set/unique_metadata.html">unique_metadata()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../operations/reference/set/sort.html">sort()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../operations/reference/checks.html">Checks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../operations/CHANGELOG.html">Changelog</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../torch/index.html">TorchScript backend</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of TorchScript backend</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../torch/reference/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../torch/reference/tensor.html">TensorMap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../torch/reference/block.html">TensorBlock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../torch/reference/labels.html">Labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../torch/reference/serialization.html">Serialization</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../torch/reference/cxx/index.html">TorchScript C++ API reference</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of TorchScript C++ API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../torch/reference/cxx/tensor.html">TensorMap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../torch/reference/cxx/block.html">TensorBlock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../torch/reference/cxx/labels.html">Labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../torch/reference/cxx/miscellaneous.html">Miscellaneous</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../torch/CHANGELOG.html">Changelog</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../learn/index.html">Learning utilities</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Learning utilities</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../learn/reference/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../learn/reference/data/index.html">Data utilites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../learn/reference/nn/index.html">Neural Network</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../examples/learn/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/learn/1-dataset-dataloader.html">Datasets and data loaders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/learn/2-indexed-dataset.html">Using IndexedDataset</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../learn/CHANGELOG.html">Changelog</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Atomistic applications</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of Atomistic applications</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Overview</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="reference/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="reference/systems.html">Systems</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="reference/models/index.html">Models</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of Models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="reference/models/export.html">Exporting models</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference/models/metadata.html">Information about models</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reference/ase.html">Atomic Simulation Environment (ASE) integration</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="reference/cxx/index.html">C++ API reference</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of C++ API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="reference/cxx/systems.html">Systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference/cxx/models.html">Models</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="outputs.html">Standard model outputs</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../examples/atomistic/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/atomistic/1-export-atomistic-model.html">Exporting a model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/atomistic/2-running-ase-md.html">Running Molecular Dynamics with ASE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/atomistic/3-atomistic-model-with-nl.html">Creating models that use neighbor lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/atomistic/4-profiling.html">Profiling your models</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../devdoc/index.html">Developer documentation</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of Developer documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../devdoc/get-started.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devdoc/architecture.html">Code organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devdoc/versions.html">Version number management</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/atomistic/overview.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="overview">
<span id="atomistic-overview"></span><h1>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h1>
<p>In recent years, there has been an explosion in the use of machine learning for
atomistic applications, in particular using ML models as interatomic potentials
for molecular simulations (i.e. molecular dynamics, Monte Carlo, …). This, in
turn, creates a lot of redundant work integrating new ML models with simulation
engines (such as <a class="reference external" href="https://wiki.fysik.dtu.dk/ase/ase/md.html">ASE</a>, <a class="reference external" href="https://lammps.org/">LAMMPS</a>, <a class="reference external" href="https://ipi-code.org/">i-PI</a>, <a class="reference external" href="https://www.gromacs.org/">GROMACS</a>, and many more!). Each
new ML model needs to write code to integrate each relevant engine one by one.</p>
<p>Our goal with metatensor atomistic models is to define a very clear boundary
between the model and the engines, such that models following the metatensor
interface can be used with <strong>any</strong> simulation engine (provided they know how to
use the interface); and that simulation engine only need to implement code to
use to ML models once, and get access to <strong>all</strong> machine learning models
following this interface.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../_images/goal-simulations.svg"><img alt="../_images/goal-simulations.svg" src="../_images/goal-simulations.svg" style="width: 500px;" />
</a>
<figcaption>
<p><span class="caption-text">Different steps in the workflow of running simulations with metatensor.
Defining a model, training a model and running simulations with it can be
done by different users; and the same metatensor-based model can be used
with multiple simulation engines.</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>This atomistic models interface is based on metatensor data format, and make
extensive use of data format ability to express sparsity (for example when
storing neighbor lists) and self-describing properties (to communicate what
exactly a model output contains in a generic manner). Using metatensor rich data
types (<a class="reference internal" href="../torch/reference/labels.html#metatensor.torch.Labels" title="metatensor.torch.Labels"><code class="xref py py-class docutils literal notranslate"><span class="pre">Labels</span></code></a>, <a class="reference internal" href="../torch/reference/block.html#metatensor.torch.TensorBlock" title="metatensor.torch.TensorBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">TensorBlock</span></code></a>, and <a class="reference internal" href="../torch/reference/tensor.html#metatensor.torch.TensorMap" title="metatensor.torch.TensorMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">TensorMap</span></code></a>)
in the atomistic interface is what allows us to make the interface smaller and
with fewer special cases. The same interface can be used to communicate about
both complex (e.g. electron density, Hamiltonian matrix elements) and simple
(e.g. energy, atomic charges) predictions of the models; and support multiple
pathways for the prediction of gradients of properties.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>We have a couple of <a class="reference internal" href="../examples/atomistic/index.html#atomistic-tutorials"><span class="std std-ref">tutorials</span></a> to learn how to
define, export, and use metatensor atomistic models.</p>
</div>
<section id="why-use-metatensor-for-atomistic-models">
<h2>Why use metatensor for atomistic models<a class="headerlink" href="#why-use-metatensor-for-atomistic-models" title="Link to this heading">¶</a></h2>
<p>The reason for using metatensor atomistic models will depend on which kind of
user you are (the same user can fall into multiple categories at different
points in time!):</p>
<dl>
<dt>Creating new machine learning architectures</dt><dd><p>You are working to define new ML architectures, incorporating the latest ML
research and coming up with new ideas to make ML models better.</p>
<p>By using metatensor, you’ll get to make your architecture available to
everyone immediately and with fewer efforts. You’ll also potentially get to
delegate the work on the simulation engine interface to other developers, by
sharing a single metatensor-based implementation with them.</p>
</dd>
<dt>Training existing architectures on new datasets</dt><dd><p>You are taking existing architectures, and training them on your own
dataset.</p>
<p>By using metatensor, you’ll get the ability to immediately test your model
inside a Python environment (with Python-based simulation engines) and once
you are confident with it, scale your simulations to larger scales while
keeping the exact same model. You can also more easily integrate various
architectures in your workflow (or even combine multiple models) and compare
them for your own data.</p>
</dd>
<dt>Running simulations to study specific systems</dt><dd><p>You want to study a specific system, and machine learning is only one of the
tools in your toolbox. You might be training your own models, or using
pre-trained models from someone else.</p>
<p>By using metatensor, you’ll get too use simulation software you are already
familiar with, instead of having to install and learn new software just to
use one specific ML model. You’ll also get an easy way to try and compare
existing models: just load them in your simulation engine and hit the floor
running!</p>
</dd>
<dt>Developing of simulation engines</dt><dd><p>You are working on software for molecular simulations, including algorithms
to sample different thermodynamic ensembles, or high performance simulation
code.</p>
<p>By using metatensor, you’ll get access to the whole space of machine
learning potentials at once! You’ll also get to use models for more than
predicting the energy of a system (for example using ML models for charge
transfers, predicting polarizability along a trajectory, <em>etc.</em>).</p>
</dd>
</dl>
</section>
<section id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Link to this heading">¶</a></h2>
<p>Metatensor atomistic models are based on PyTorch, and more particularly
<a class="reference external" href="https://pytorch.org/docs/stable/jit.html">TorchScript</a>. TorchScript is a programming language which is mainly a subset
of Python, and PyTorch contains a compiler from Python to TorchScript code.
After doing this translation, the model no longer depends on Python and can be
executed directly inside simulation engines implemented in C, C++, Fortran, …
This approach allow to define and tweak models as Python code, and then once
they are working as intended, export them to a Python-independent representation
to be used in simulations.</p>
<p>In practice, models should be defined as custom <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="(in PyTorch v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.Module</span></code></a>
sub-class, following our <a class="reference internal" href="reference/models/export.html#metatensor.torch.atomistic.ModelInterface" title="metatensor.torch.atomistic.ModelInterface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelInterface</span></code></a>. New models can be written
using this interface directly, and pre-existing models can use a small wrapper
to convert from this interface to the model’s existing input and output data.
The models take as input a set of atomistic <a class="reference internal" href="reference/systems.html#metatensor.torch.atomistic.System" title="metatensor.torch.atomistic.System"><code class="xref py py-class docutils literal notranslate"><span class="pre">System</span></code></a> (typically a
single one during simulations, and multiple systems during training); a set of
<code class="docutils literal notranslate"><span class="pre">outputs</span></code> requested by the engine, and should make prediction for all
properties in the <code class="docutils literal notranslate"><span class="pre">outputs</span></code>. All predictions are then returned to the engine
in a dictionary of <a class="reference internal" href="../torch/reference/tensor.html#metatensor.torch.TensorMap" title="metatensor.torch.TensorMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">metatensor.torch.TensorMap</span></code></a>, one such tensor map
for each property (i.e. energy, atomic charges, dipole, electronic density,
chemical shielding, <em>etc.</em>)</p>
<p>Once a model is defined and trained, it should be exported by constructing a
<a class="reference internal" href="reference/models/export.html#metatensor.torch.atomistic.MetatensorAtomisticModel" title="metatensor.torch.atomistic.MetatensorAtomisticModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetatensorAtomisticModel</span></code></a>, and calling <code class="docutils literal notranslate"><span class="pre">export</span></code> on it. This class
is a wrapper for the model that will handle unit conversions on input and
outputs. It will also store metadata about the model (such as the authors, a
list of references, …) and the model capabilities (what properties it can
compute, which neighbors list the whole model requires, …). Optionally, this
class can also check that both data provided by the engine and properties
computed by the model follow the metatensor interface, which can be used to
debug your code.</p>
<p>Finally, the exported model can be loaded by simulation engines and used to run
simulations and make predictions.</p>
</section>
<section id="constrains-on-atomistic-models">
<h2>Constrains on atomistic models<a class="headerlink" href="#constrains-on-atomistic-models" title="Link to this heading">¶</a></h2>
<p>There are a couple of constrains on what a given model must do to be useable
with metatensor, but apart from these you can do what you want inside the
model!</p>
<p>The main constrain is that the model must be compatible with <a class="reference external" href="https://pytorch.org/docs/stable/jit.html">TorchScript</a>,
i.e. you must use either pure PyTorch code in the definition of your model, or
implement a custom TorchScript extension for any operations where a pure PyTorch
implementation is too slow or too much work. See the <cite>corresponding
documentation &lt;torch-extensions&gt;_</cite> for more information on custom TorchScript
extensions.</p>
<p>Your model should also only take data from our <a class="reference internal" href="reference/systems.html#metatensor.torch.atomistic.System" title="metatensor.torch.atomistic.System"><code class="xref py py-class docutils literal notranslate"><span class="pre">System</span></code></a> definition:
atomic types and positions, simulation cell, and list of neighbors for different
spherical cutoffs.</p>
<p>If you need additional data that you can not compute inside the model (such as
atomic spins, non-spherical particle orientation, <em>etc.</em>) you can use
<a class="reference internal" href="reference/systems.html#metatensor.torch.atomistic.System.get_data" title="metatensor.torch.atomistic.System.get_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">System.get_data()</span></code></a>, but this comes with significant caveats:</p>
<ul class="simple">
<li><p>anything going through <a class="reference internal" href="reference/systems.html#metatensor.torch.atomistic.System.get_data" title="metatensor.torch.atomistic.System.get_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">System.get_data()</span></code></a> is experimental with no
stability guarantee;</p></li>
<li><p>you must modify the engine code to use <a class="reference internal" href="reference/systems.html#metatensor.torch.atomistic.System.add_data" title="metatensor.torch.atomistic.System.add_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">System.add_data()</span></code></a> to add the
required data to the systems;</p></li>
</ul>
<p>If you need such data, please contact us (using email or <a class="reference external" href="https://github.com/lab-cosmo/metatensor/issues/new">GitHub issues</a>) to
formulate a plan to add it to metatensor interface!</p>
<p>Finally, your model can compute and output what it wants, and organize the data
and metadata of the outputs as it pleases, except for a set of standardized
outputs (identified by the corresponding key in the output dictionary). These
standardized outputs are documented in <a class="reference internal" href="outputs.html#atomistic-models-outputs"><span class="std std-ref">this page</span></a>.</p>
</section>
<section id="data-flow-between-the-model-and-engine">
<span id="model-dataflow"></span><h2>Data flow between the model and engine<a class="headerlink" href="#data-flow-between-the-model-and-engine" title="Link to this heading">¶</a></h2>
<p>The sequence of operations to use a metatensor atomistic model from a simulation
engine follows the same high level sequence of operations, illustrated and
explained below.</p>
<style>
    body[data-theme="light"] {
        --color-admonition-title--tip: #7c7c7c;
        --color-admonition-title-background--tip: #b9b9b9;
    }

    body[data-theme="auto"] {
        @media (prefers-color-scheme: light) {
            --color-admonition-title--tip: #7c7c7c;
            --color-admonition-title-background--tip: #b9b9b9;
        }
    }
</style><figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/model-dataflow.svg"><img alt="../_images/model-dataflow.svg" src="../_images/model-dataflow.svg" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">Illustration of the flow of data between the engine and the model.</span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic">
<li><p>the engine loads an exported model from a file;</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The engine should use <a class="reference internal" href="reference/models/index.html#metatensor.torch.atomistic.check_atomistic_model" title="metatensor.torch.atomistic.check_atomistic_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_atomistic_model()</span></code></a> or
<a class="reference internal" href="reference/cxx/models.html#_CPPv4N16metatensor_torch20load_atomistic_modelENSt6stringEN3c108optionalINSt6stringEEE" title="metatensor_torch::load_atomistic_model"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">metatensor_torch::load_atomistic_model()</span></code></a> to also perform
checks before loading the model.</p>
</div>
</li>
<li><p>the engine requests and gets its capabilities from the model;</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This can be done by calling
<a class="reference internal" href="reference/models/export.html#metatensor.torch.atomistic.MetatensorAtomisticModel.capabilities" title="metatensor.torch.atomistic.MetatensorAtomisticModel.capabilities"><code class="xref py py-func docutils literal notranslate"><span class="pre">MetatensorAtomisticModel.capabilities()</span></code></a>. This function is also
exported to TorchScript and can be called from C++ with
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">torch::jit::Module::run_method()</span></code>.</p>
</div>
</li>
<li><p>the engine creates the <a class="reference internal" href="reference/models/metadata.html#metatensor.torch.atomistic.ModelEvaluationOptions" title="metatensor.torch.atomistic.ModelEvaluationOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelEvaluationOptions</span></code></a> based on the
model’s capabilities and user input;</p></li>
<li><p>the engine creates a list of <a class="reference internal" href="reference/systems.html#metatensor.torch.atomistic.System" title="metatensor.torch.atomistic.System"><code class="xref py py-class docutils literal notranslate"><span class="pre">System</span></code></a> (typically the list only
contains one system) matching its own internal data representation;</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code class="docutils literal notranslate"><span class="pre">positions</span></code> and <code class="docutils literal notranslate"><span class="pre">cell</span></code> should have their respective
<code class="docutils literal notranslate"><span class="pre">requires_grad</span></code> parameters set if the engine wants to run backward
propagation at step 10.</p>
</div>
</li>
<li><p>the engine asks the model for the required neighbor lists;</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This can be done by calling
<a class="reference internal" href="reference/models/export.html#metatensor.torch.atomistic.MetatensorAtomisticModel.requested_neighbor_lists" title="metatensor.torch.atomistic.MetatensorAtomisticModel.requested_neighbor_lists"><code class="xref py py-func docutils literal notranslate"><span class="pre">MetatensorAtomisticModel.requested_neighbor_lists()</span></code></a>. This
function is also exported to TorchScript and can be called from C++ with
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">torch::jit::Module::run_method()</span></code>.</p>
</div>
</li>
<li><p>the engine computes the neighbor lists corresponding to the model requests,
and register them with all systems;</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If the engine does not use torch to compute the neighbor lists (using
instead some other neighbors list implementation), the neighbors list
should be registered with torch’s automatic differentiation framework by
using <a class="reference internal" href="reference/systems.html#metatensor.torch.atomistic.register_autograd_neighbors" title="metatensor.torch.atomistic.register_autograd_neighbors"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_autograd_neighbors()</span></code></a> before adding the neighbors
lists to the systems.</p>
<p>We provide a set of regression tests for neighbors lists in
<cite>metatensor-torch/tests/neighbor-checks</cite>. The data in these files can be
used to validate that a specific engine is computing the expected set of
pairs for integration with metatensor models.</p>
</div>
</li>
<li><p>the engine calls the model <code class="docutils literal notranslate"><span class="pre">forward()</span></code> function with all the systems, the
evaluations options and selected atoms, if any;</p></li>
<li><p>the model runs and executes its calculations;</p></li>
<li><p>the model returns all the requested outputs to the engine;</p></li>
<li><p>if needed, the engine runs <code class="docutils literal notranslate"><span class="pre">backward()</span></code> on the outputs to get gradients of
some outputs with backward propagation;</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The API for metatensor atomistic models also supports gradients computed
during the forward pass with <a class="reference internal" href="reference/models/metadata.html#metatensor.torch.atomistic.ModelOutput.explicit_gradients" title="metatensor.torch.atomistic.ModelOutput.explicit_gradients"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelOutput.explicit_gradients</span></code></a>.
Most models will not support this option though, and as such it is
better to try to rely on backward differentiation gradients where
possible.</p>
</div>
</li>
</ol>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="reference/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Atomistic applications</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Guillaume Fraux, Davide Tisi, Philip Loche, Joseph W. Abbott, Jigyasa Nigam, Chiheb Ben Mahmoud
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Overview</a><ul>
<li><a class="reference internal" href="#why-use-metatensor-for-atomistic-models">Why use metatensor for atomistic models</a></li>
<li><a class="reference internal" href="#how-it-works">How it works</a></li>
<li><a class="reference internal" href="#constrains-on-atomistic-models">Constrains on atomistic models</a></li>
<li><a class="reference internal" href="#data-flow-between-the-model-and-engine">Data flow between the model and engine</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/toggleprompt.js?v=5801b3bb"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/custom.js?v=4b1677b9"></script>
    <script data-domain="docs.metatensor.org" defer="defer" src="https://plausible.io/js/script.js"></script>
    </body>
</html>